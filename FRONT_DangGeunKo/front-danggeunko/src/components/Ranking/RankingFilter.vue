<template>
  <div class="filter-row">
    <div class="filter-buttons">
      <button class="pill-btn" :class="{ active: isVisible }" @click="isVisible = !isVisible">
        ì§€ì—­ <span class="caret">â–¾</span>
      </button>
    </div>
  </div>

  <div class="filter-options" v-show="isVisible">
    <div class="region-control" style="display: block;">
      <div style="margin-bottom: 0.4rem; color: var(--text-sub)">ë„ì‹œ / ì§€ì—­êµ¬ ì„ íƒ</div>
      <div class="region-selects">
        <select v-model="searchInfo.courseCity" @change="handleCityChange">
          <option value="">ì‹œ/ë„ ì„ íƒ</option>
          <option v-for="(districts, cityName) in regionDB" :key="cityName" :value="cityName">
            {{ cityName }}
          </option>
        </select>

        <select v-model="searchInfo.courseDistrict">
          <option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>
          <option v-for="gu in availableDistricts" :key="gu" :value="gu">
            {{ gu }}
          </option>
        </select>
      </div>
    </div>
  </div>
</template>

<script setup>
import { useCourseStore } from '@/stores/course'
import { storeToRefs } from 'pinia'
import { ref, onMounted, watch, computed } from 'vue'

//ì½”ìŠ¤
const store = useCourseStore()
const { searchInfo } = storeToRefs(store);
const isVisible = ref(false)
const getRankingList = async () => {
  await store.getWeeklyRanking()
}

watch(
  searchInfo,
  async () => {
    await getRankingList()
  },
  { deep: true }
)

/////////////////////////////////////////////////////////////////////////

const regionDB = {

  "ì„œìš¸íŠ¹ë³„ì‹œ": ["ê°•ë‚¨êµ¬", "ê°•ë™êµ¬", "ê°•ë¶êµ¬", "ê°•ì„œêµ¬", "ê´€ì•…êµ¬", "ê´‘ì§„êµ¬", "êµ¬ë¡œêµ¬", "ê¸ˆì²œêµ¬", "ë…¸ì›êµ¬", "ë„ë´‰êµ¬", "ë™ëŒ€ë¬¸êµ¬", "ë™ì‘êµ¬",
    "ë§ˆí¬êµ¬", "ì„œëŒ€ë¬¸êµ¬", "ì„œì´ˆêµ¬", "ì„±ë™êµ¬", "ì„±ë¶êµ¬", "ì†¡íŒŒêµ¬", "ì–‘ì²œêµ¬", "ì˜ë“±í¬êµ¬", "ìš©ì‚°êµ¬", "ì€í‰êµ¬", "ì¢…ë¡œêµ¬", "ì¤‘êµ¬", "ì¤‘ë‘êµ¬", "ìš©ì‚°êµ¬"],

  "ë¶€ì‚°ê´‘ì—­ì‹œ": [
    "ê°•ì„œêµ¬", "ê¸ˆì •êµ¬", "ê¸°ì¥êµ°", "ë‚¨êµ¬", "ë™ë˜êµ¬", "ë¶€ì‚°ì§„êµ¬", "ë¶êµ¬", "ì‚¬ìƒêµ¬", "ì‚¬í•˜êµ¬", "ì„œêµ¬", "ìˆ˜ì˜êµ¬", "ì—°ì œêµ¬",
    "ì˜ë„êµ¬", "ì¤‘êµ¬", "í•´ìš´ëŒ€êµ¬"],

  "ëŒ€êµ¬ê´‘ì—­ì‹œ": ["êµ°ìœ„êµ°", "ë‚¨êµ¬", "ë‹¬ì„œêµ¬", "ë‹¬ì„±êµ°", "ë™êµ¬", "ë¶êµ¬", "ì„œêµ¬", "ìˆ˜ì„±êµ¬", "ì¤‘êµ¬"],
  "ì¸ì²œê´‘ì—­ì‹œ": ["ê°•í™”êµ°", "ê³„ì–‘êµ¬", "ë‚¨ë™êµ¬", "ë™êµ¬", "ë¯¸ì¶”í™€êµ¬", "ë¶€í‰êµ¬", "ì„œêµ¬", "ì—°ìˆ˜êµ¬", "ì˜¹ì§„êµ°", "ì¤‘êµ¬"],
  "ëŒ€ì „ê´‘ì—­ì‹œ": ["ëŒ€ë•êµ¬", "ë™êµ¬", "ì„œêµ¬", "ìœ ì„±êµ¬", "ì¤‘êµ¬"],
  "ê´‘ì£¼ê´‘ì—­ì‹œ": ["ê´‘ì‚°êµ¬", "ë‚¨êµ¬", "ë™êµ¬", "ë¶êµ¬", "ì„œêµ¬"],
  "ìš¸ì‚°ê´‘ì—­ì‹œ": ["ë‚¨êµ¬", "ë™êµ¬", "ë¶êµ¬", "ìš¸ì£¼êµ°", "ì¤‘êµ¬"],

  "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ": [""],

  // ======================
  // ğŸ”¥ ê²½ê¸°ë„ ì „ì²´ í™•ì¥
  // ======================
  "ê²½ê¸°ë„": [
    "ê°€í‰êµ°", "ê³ ì–‘ì‹œ ë•ì–‘êµ¬", "ê³ ì–‘ì‹œ ì¼ì‚°ë™êµ¬", "ê³ ì–‘ì‹œ ì¼ì‚°ì„œêµ¬",
    "ê³¼ì²œì‹œ", "ê´‘ëª…ì‹œ", "ê´‘ì£¼ì‹œ",
    "êµ¬ë¦¬ì‹œ", "êµ°í¬ì‹œ",
    "ê¹€í¬ì‹œ", "ë‚¨ì–‘ì£¼ì‹œ",
    "ë™ë‘ì²œì‹œ",
    "ë¶€ì²œì‹œ ì†Œì‚¬êµ¬", "ë¶€ì²œì‹œ ì˜¤ì •êµ¬", "ë¶€ì²œì‹œ ì›ë¯¸êµ¬",
    "ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬", "ì„±ë‚¨ì‹œ ìˆ˜ì •êµ¬", "ì„±ë‚¨ì‹œ ì¤‘ì›êµ¬",
    "ìˆ˜ì›ì‹œ ê¶Œì„ êµ¬", "ìˆ˜ì›ì‹œ ì˜í†µêµ¬", "ìˆ˜ì›ì‹œ ì¥ì•ˆêµ¬", "ìˆ˜ì›ì‹œ íŒ”ë‹¬êµ¬",
    "ì‹œí¥ì‹œ", "ì•ˆì‚°ì‹œ ë‹¨ì›êµ¬", "ì•ˆì‚°ì‹œ ìƒë¡êµ¬",
    "ì•ˆì„±ì‹œ", "ì•ˆì–‘ì‹œ ë™ì•ˆêµ¬", "ì•ˆì–‘ì‹œ ë§Œì•ˆêµ¬",
    "ì–‘ì£¼ì‹œ", "ì–‘í‰êµ°",
    "ì—¬ì£¼ì‹œ", "ì—°ì²œêµ°",
    "ì˜¤ì‚°ì‹œ", "ìš©ì¸ì‹œ ê¸°í¥êµ¬", "ìš©ì¸ì‹œ ìˆ˜ì§€êµ¬", "ìš©ì¸ì‹œ ì²˜ì¸êµ¬",
    "ì˜ì™•ì‹œ", "ì˜ì •ë¶€ì‹œ",
    "ì´ì²œì‹œ", "íŒŒì£¼ì‹œ", "í‰íƒì‹œ", "í¬ì²œì‹œ", "í•˜ë‚¨ì‹œ", "í™”ì„±ì‹œ"
  ],

  "ê°•ì›ë„": [
    "ê°•ë¦‰ì‹œ", "ê³ ì„±êµ°", "ë™í•´ì‹œ", "ì‚¼ì²™ì‹œ", "ì†ì´ˆì‹œ", "ì–‘êµ¬êµ°",
    "ì–‘ì–‘êµ°", "ì˜ì›”êµ°", "ì›ì£¼ì‹œ", "ì¸ì œêµ°", "ì •ì„ êµ°",
    "ì² ì›êµ°", "ì¶˜ì²œì‹œ", "íƒœë°±ì‹œ", "í‰ì°½êµ°", "í™ì²œêµ°", "í™”ì²œêµ°"
  ],
  "ì¶©ì²­ë¶ë„": [
    "ê´´ì‚°êµ°", "ë‹¨ì–‘êµ°", "ë³´ì€êµ°", "ì˜ë™êµ°", "ì˜¥ì²œêµ°", "ìŒì„±êµ°",
    "ì œì²œì‹œ", "ì¦í‰êµ°", "ì§„ì²œêµ°", "ì²­ì£¼ì‹œ ìƒë‹¹êµ¬",
    "ì²­ì£¼ì‹œ ì„œì›êµ¬", "ì²­ì£¼ì‹œ ì²­ì›êµ¬", "ì²­ì£¼ì‹œ í¥ë•êµ¬", "ì¶©ì£¼ì‹œ"
  ],
  "ì¶©ì²­ë‚¨ë„": [
    "ê³„ë£¡ì‹œ", "ê³µì£¼ì‹œ", "ê¸ˆì‚°êµ°", "ë…¼ì‚°ì‹œ", "ë‹¹ì§„ì‹œ", "ë³´ë ¹ì‹œ",
    "ë¶€ì—¬êµ°", "ì„œì‚°ì‹œ", "ì•„ì‚°ì‹œ", "ì˜ˆì‚°êµ°", "ì²œì•ˆì‹œ ë™ë‚¨êµ¬",
    "ì²œì•ˆì‹œ ì„œë¶êµ¬", "ì²­ì–‘êµ°", "íƒœì•ˆêµ°", "í™ì„±êµ°"
  ],

  "ì „ë¼ë¶ë„": [
    "ê³ ì°½êµ°", "êµ°ì‚°ì‹œ", "ê¹€ì œì‹œ", "ë‚¨ì›ì‹œ", "ë¬´ì£¼êµ°", "ë¶€ì•ˆêµ°",
    "ìˆœì°½êµ°", "ì™„ì£¼êµ°", "ìµì‚°ì‹œ", "ì„ì‹¤êµ°", "ì¥ìˆ˜êµ°",
    "ì „ì£¼ì‹œ ë•ì§„êµ¬", "ì „ì£¼ì‹œ ì™„ì‚°êµ¬", "ì •ìì‹œ", "ì§„ì•ˆêµ°"
  ],
  "ì „ë¼ë‚¨ë„": [
    "ê°•ì§„êµ°", "ê³ í¥êµ°", "ê³¡ì„±êµ°", "ê´‘ì–‘ì‹œ", "êµ¬ë¡€êµ°", "ë‚˜ì£¼ì‹œ",
    "ë‹´ì–‘êµ°", "ëª©í¬ì‹œ", "ë¬´ì•ˆêµ°", "ë³´ì„±êµ°", "ìˆœì²œì‹œ",
    "ì‹ ì•ˆêµ°", "ì—¬ìˆ˜ì‹œ", "ì˜ê´‘êµ°", "ì˜ì•”êµ°", "ì™„ë„êµ°",
    "ì¥ì„±êµ°", "ì¥í¥êµ°", "ì§„ë„êµ°", "í•¨í‰êµ°", "í•´ë‚¨êµ°", "í™”ìˆœêµ°"
  ],

  "ê²½ìƒë¶ë„": [
    "ê²½ì‚°ì‹œ", "ê²½ì£¼ì‹œ", "ê³ ë ¹êµ°", "êµ¬ë¯¸ì‹œ", "ê¹€ì²œì‹œ", "ë¬¸ê²½ì‹œ",
    "ë´‰í™”êµ°", "ìƒì£¼ì‹œ", "ì„±ì£¼êµ°", "ì•ˆë™ì‹œ", "ì˜ë•êµ°", "ì˜ì–‘êµ°",
    "ì˜ì£¼ì‹œ", "ì˜ì²œì‹œ", "ì˜ˆì²œêµ°", "ìš¸ë¦‰êµ°", "ìš¸ì§„êµ°",
    "ì˜ì„±êµ°", "ì²­ë„êµ°", "ì²­ì†¡êµ°", "ì¹ ê³¡êµ°", "í¬í•­ì‹œ ë‚¨êµ¬", "í¬í•­ì‹œ ë¶êµ¬"
  ],

  "ê²½ìƒë‚¨ë„": [
    "ê±°ì œì‹œ", "ê±°ì°½êµ°", "ê³ ì„±êµ°", "ê¹€í•´ì‹œ", "ë‚¨í•´êµ°", "ë°€ì–‘ì‹œ",
    "ì‚¬ì²œì‹œ", "ì‚°ì²­êµ°", "ì–‘ì‚°ì‹œ", "ì˜ë ¹êµ°", "ì§„ì£¼ì‹œ", "ì§„í•´êµ¬",
    "ì°½ë…•êµ°", "ì°½ì›ì‹œ ë§ˆì‚°í•©í¬êµ¬", "ì°½ì›ì‹œ ë§ˆì‚°íšŒì›êµ¬", "ì°½ì›ì‹œ ì„±ì‚°êµ¬",
    "ì°½ì›ì‹œ ì˜ì°½êµ¬", "ì°½ì›ì‹œ ì§„í•´êµ¬", "í†µì˜ì‹œ", "í•˜ë™êµ°", "í•©ì²œêµ°"
  ],
  "ì œì£¼íŠ¹ë³„ìì¹˜ë„": ["ì œì£¼ì‹œ", "ì„œê·€í¬ì‹œ"]
};



// 1. ì„ íƒëœ ë„ì‹œì— ë§ì¶° ìë™ìœ¼ë¡œ êµ¬ ëª©ë¡ì„ í•„í„°ë§í•¨ (ë°˜ì‘í˜•)
const availableDistricts = computed(() => {
  const city = searchInfo.value.courseCity;
  return regionDB[city] || [];
});

// 2. ë„ì‹œê°€ ë³€ê²½ë  ë•Œ êµ¬ ì„ íƒê°’ì„ ì´ˆê¸°í™”í•¨
const handleCityChange = () => {
  searchInfo.value.courseDistrict = '';
};

// 3. í•„í„°ë§ ë°ì´í„° ë³€í™” ê°ì‹œí•˜ì—¬ ì„œë²„ ë°ì´í„° í˜¸ì¶œ
watch(
  () => searchInfo.value,
  () => {
    store.getWeeklyRanking();
  },
  { deep: true }
);

// 4. í•„í„°ê°€ ë‹«í ë•Œ ë°ì´í„° ì´ˆê¸°í™” (í•„ìš”í•œ ê²½ìš°)
watch(isVisible, (val) => {
  if (!val) {
    searchInfo.value.courseCity = '';
    searchInfo.value.courseDistrict = '';
  }
});


</script>

<style scoped></style>